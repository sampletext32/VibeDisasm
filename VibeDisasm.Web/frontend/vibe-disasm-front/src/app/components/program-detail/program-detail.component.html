<div class="container mat-elevation-z2">
  <div class="header">
    <div class="header-left">
      <button mat-icon-button (click)="goBack()" aria-label="Back">
        <mat-icon>arrow_back</mat-icon>
      </button>
      <h2>Program Analysis: <span class="program-name">{{ programName }}</span></h2>
    </div>
    <div class="header-right">
      <button mat-raised-button color="primary" [routerLink]="['/decompile', programId]">
        <mat-icon>code</mat-icon>
        Decompile
      </button>
    </div>
  </div>

  <div class="content-container">
    @if (loading) {
      <div class="loading-container">
        <mat-spinner diameter="40"></mat-spinner>
      </div>
    }

    <mat-tab-group (selectedTabChange)="setActiveTab($event.tab.textLabel.toLowerCase().replace(' ', '-'))">
      <mat-tab label="PE Info">
        @if (peInfo) {
          <div class="tab-content">
            <h2>PE Information</h2>
            <!-- TODO: Display PE info details -->
            <pre>{{ peInfo | json }}</pre>
          </div>
        }
      </mat-tab>

      <mat-tab label="Sections">
        @if (sections.length > 0) {
          <div class="tab-content">
            <h2>Sections</h2>
            <!-- TODO: Display sections in a table -->
            <table mat-table [dataSource]="sections" class="mat-elevation-z1 full-width">
              <ng-container matColumnDef="name">
                <th mat-header-cell *matHeaderCellDef>Name</th>
                <td mat-cell *matCellDef="let section">{{ section.name }}</td>
              </ng-container>
              <ng-container matColumnDef="virtualAddress">
                <th mat-header-cell *matHeaderCellDef>Virtual Address</th>
                <td mat-cell *matCellDef="let section" class="monospace">0x{{ section.virtualAddress.toString(16).padStart(8, '0') }}</td>
              </ng-container>
              <ng-container matColumnDef="virtualSize">
                <th mat-header-cell *matHeaderCellDef>Virtual Size</th>
                <td mat-cell *matCellDef="let section" class="monospace">0x{{ section.virtualSize.toString(16).padStart(8, '0') }}</td>
              </ng-container>
              <ng-container matColumnDef="rawDataAddress">
                <th mat-header-cell *matHeaderCellDef>Raw Address</th>
                <td mat-cell *matCellDef="let section" class="monospace">0x{{ section.rawDataAddress.toString(16).padStart(8, '0') }}</td>
              </ng-container>
              <ng-container matColumnDef="rawDataSize">
                <th mat-header-cell *matHeaderCellDef>Raw Size</th>
                <td mat-cell *matCellDef="let section" class="monospace">0x{{ section.rawDataSize.toString(16).padStart(8, '0') }}</td>
              </ng-container>
              <ng-container matColumnDef="characteristics">
                <th mat-header-cell *matHeaderCellDef>Characteristics</th>
                <td mat-cell *matCellDef="let section" class="monospace">0x{{ section.characteristics.toString(16).padStart(8, '0') }}</td>
              </ng-container>
              <ng-container matColumnDef="isExecutable">
                <th mat-header-cell *matHeaderCellDef>Executable</th>
                <td mat-cell *matCellDef="let section">
                  @if (section.isExecutable) {
                    <mat-icon color="accent">check_circle</mat-icon>
                  }
                  @if (!section.isExecutable) {
                    <mat-icon color="warn">cancel</mat-icon>
                  }
                </td>
              </ng-container>
              <ng-container matColumnDef="isReadable">
                <th mat-header-cell *matHeaderCellDef>Readable</th>
                <td mat-cell *matCellDef="let section">
                  @if (section.isReadable) {
                    <mat-icon color="accent">check_circle</mat-icon>
                  }
                  @if (!section.isReadable) {
                    <mat-icon color="warn">cancel</mat-icon>
                  }
                </td>
              </ng-container>
              <tr mat-header-row *matHeaderRowDef="['name', 'virtualAddress', 'virtualSize', 'rawDataAddress', 'rawDataSize', 'characteristics', 'isExecutable', 'isReadable']"></tr>
              <tr mat-row *matRowDef="let row; columns: ['name', 'virtualAddress', 'virtualSize', 'rawDataAddress', 'rawDataSize', 'characteristics', 'isExecutable', 'isReadable'];"></tr>
            </table>
          </div>
        }
      </mat-tab>

      <mat-tab label="TLS">
        @if (tlsInfo) {
          <div class="tab-content">
            <h2>Thread Local Storage</h2>
            <!-- TODO: Display TLS info details -->
            <pre>{{ tlsInfo | json }}</pre>
          </div>
        }
      </mat-tab>

      <mat-tab label="Entry Points">
        @if (entryPoints.length > 0) {
          <div class="tab-content">
            <h2>Entry Points</h2>
            <!-- TODO: Display entry points in a list -->
            <table mat-table [dataSource]="entryPoints" class="mat-elevation-z1 full-width">
              <ng-container matColumnDef="fileOffset">
                <th mat-header-cell *matHeaderCellDef>File Offset</th>
                <td mat-cell *matCellDef="let entry" class="monospace">0x{{ entry.fileOffset.toString(16).padStart(8, '0') }}</td>
              </ng-container>
              <ng-container matColumnDef="rva">
                <th mat-header-cell *matHeaderCellDef>RVA</th>
                <td mat-cell *matCellDef="let entry" class="monospace">0x{{ entry.rva.toString(16).padStart(8, '0') }}</td>
              </ng-container>
              <ng-container matColumnDef="source">
                <th mat-header-cell *matHeaderCellDef>Source</th>
                <td mat-cell *matCellDef="let entry">{{ entry.source }}</td>
              </ng-container>
              <ng-container matColumnDef="description">
                <th mat-header-cell *matHeaderCellDef>Description</th>
                <td mat-cell *matCellDef="let entry">{{ entry.description }}</td>
              </ng-container>
              <tr mat-header-row *matHeaderRowDef="['fileOffset', 'rva', 'source', 'description']"></tr>
              <tr mat-row *matRowDef="let row; columns: ['fileOffset', 'rva', 'source', 'description'];"></tr>
            </table>
          </div>
        }
      </mat-tab>

      <mat-tab label="Imports">
        @if (imports) {
          <div class="tab-content">
            <h2>Imports</h2>
            <!-- TODO: Display imports in a structured way -->
            <pre>{{ imports | json }}</pre>
          </div>
        }
      </mat-tab>

      <mat-tab label="Exports">
        @if (exports) {
          <div class="tab-content">
            <h2>Exports</h2>
            <!-- TODO: Display exports in a structured way -->
            <pre>{{ exports | json }}</pre>
          </div>
        }
      </mat-tab>

      <mat-tab label="Resources">
        @if (resources) {
          <div class="tab-content">
            <h2>Resources</h2>
            <!-- TODO: Display resources in a structured way -->
            <pre>{{ resources | json }}</pre>
          </div>
        }
      </mat-tab>

      <mat-tab label="Delay Imports">
        @if (delayImports) {
          <div class="tab-content">
            <h2>Delay Imports</h2>
            <!-- TODO: Display delay imports in a structured way -->
            <pre>{{ delayImports | json }}</pre>
          </div>
        }
      </mat-tab>

      <mat-tab label="Exceptions">
        @if (exceptions) {
          <div class="tab-content">
            <h2>Exceptions</h2>
            <!-- TODO: Display exceptions in a structured way -->
            <pre>{{ exceptions | json }}</pre>
          </div>
        }
      </mat-tab>

      <mat-tab label="Version Info">
        @if (versionInfo.length > 0) {
          <div class="tab-content">
            <h2>Version Information</h2>
            <!-- TODO: Display version info in a structured way -->
            <pre>{{ versionInfo | json }}</pre>
          </div>
        }
      </mat-tab>

      <mat-tab label="String Table">
        @if (stringTable.length > 0) {
          <div class="tab-content">
            <h2>String Table</h2>
            <!-- TODO: Display string table in a structured way -->
            <mat-list>
              @for (str of stringTable; track str) {
                <mat-list-item>
                  <span class="monospace">{{ str.value }}</span>
                </mat-list-item>
              }
            </mat-list>
          </div>
        }
      </mat-tab>
    </mat-tab-group>
  </div>
</div>
